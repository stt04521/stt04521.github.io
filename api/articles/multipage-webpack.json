{"title":"多页面webpack 解决方案","slug":"multipage-webpack","date":"2017-07-09T09:16:47.000Z","updated":"2017-07-09T10:38:55.000Z","comments":true,"excerpt":"<p>多页面的webapck解决方案</p>","content":"<p>多页面的webapck解决方案</p>\n<a id=\"more\"></a>\n<h2 id=\"webpack的前端工程化开发之多页面\"><a href=\"#webpack的前端工程化开发之多页面\" class=\"headerlink\" title=\"webpack的前端工程化开发之多页面\"></a>webpack的前端工程化开发之多页面</h2><p>在最初接触webpack的较长一段时间里，我（也可能很多人）都觉得webpack是专为单页应用而量身打造的，比如webpack+react、webpack+vue等，都可以近乎完美的解决各种资源的依赖加载、打包的问题。甚至css都是打包在js里去动态添加到dom文档中去。</p>\n<p>后来想想，这么好的工具这么好的方案为什么不能用在website（普通的web站点，姑且叫做website吧）中呢？</p>\n<ul>\n<li><p>首先对于普通的web站点，我们更倾向于将css独立出来，因为对于website来说，css还是要最先加载出来比较好。</p>\n</li>\n<li><p>再然后js我们也只想加载需要的部分，而不是一个大大的打包了所有js模块的包。</p>\n</li>\n</ul>\n<p>在很多webpack入门级的demo里，无论是单入口的还是多入口的，都没有解决上面两个问题。入门毕竟是入门，要晋级还是只能靠自己。幸运的是，有很多优秀的工程师已为我们铺好了路，让我们在前端工程化的道路上少走很多的弯路。如果你也一样曾迷茫过，请不要走开，希望这里能为你答疑解惑。</p>\n<p>好吧，以上通通是废话，接下来上干货。</p>\n<hr>\n<p>首先开始构建我们的项目目录结构。</p>\n<h4 id=\"初始化项目、安装依赖\"><a href=\"#初始化项目、安装依赖\" class=\"headerlink\" title=\"初始化项目、安装依赖\"></a>初始化项目、安装依赖</h4><p>使用<code>npm init</code>初始化项目就不多说了，生成package.json文件。</p>\n<p>使用<code>npm install plugins --save-dev</code>安装项目所需依赖。最终package.json的依赖声明如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"string\">\"devDependencies\"</span>: &#123;</div><div class=\"line\">    <span class=\"string\">\"art-template\"</span>: <span class=\"string\">\"^4.9.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"art-template-loader\"</span>: <span class=\"string\">\"^1.4.3\"</span>,</div><div class=\"line\">    <span class=\"string\">\"autoprefixer\"</span>: <span class=\"string\">\"^7.1.0\"</span>,</div><div class=\"line\">    <span class=\"string\">\"babel-cli\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"babel-core\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"babel-loader\"</span>: <span class=\"string\">\"^7.0.0\"</span>,</div><div class=\"line\">    <span class=\"string\">\"babel-preset-es2015\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"babel-preset-latest\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"babel-preset-stage-0\"</span>: <span class=\"string\">\"^6.24.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"babel-runtime\"</span>: <span class=\"string\">\"^6.23.0\"</span>,</div><div class=\"line\">    <span class=\"string\">\"css-loader\"</span>: <span class=\"string\">\"^0.23.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"expose-loader\"</span>: <span class=\"string\">\"^0.7.3\"</span>,</div><div class=\"line\">    <span class=\"string\">\"extract-text-webpack-plugin\"</span>: <span class=\"string\">\"^1.0.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"file-loader\"</span>: <span class=\"string\">\"^0.11.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"glob\"</span>: <span class=\"string\">\"^7.1.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"html-loader\"</span>: <span class=\"string\">\"^0.4.3\"</span>,</div><div class=\"line\">    <span class=\"string\">\"html-webpack-plugin\"</span>: <span class=\"string\">\"^2.9.0\"</span>,</div><div class=\"line\">    <span class=\"string\">\"jquery\"</span>: <span class=\"string\">\"^1.12.0\"</span>,</div><div class=\"line\">    <span class=\"string\">\"less\"</span>: <span class=\"string\">\"^2.6.0\"</span>,</div><div class=\"line\">    <span class=\"string\">\"less-loader\"</span>: <span class=\"string\">\"^2.2.2\"</span>,</div><div class=\"line\">    <span class=\"string\">\"postcss-loader\"</span>: <span class=\"string\">\"^2.0.5\"</span>,</div><div class=\"line\">    <span class=\"string\">\"precss\"</span>: <span class=\"string\">\"^1.4.0\"</span>,</div><div class=\"line\">    <span class=\"string\">\"raw-loader\"</span>: <span class=\"string\">\"^0.5.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"refresh-browser-webpack-plugin\"</span>: <span class=\"string\">\"1.0.2\"</span>,</div><div class=\"line\">    <span class=\"string\">\"style-loader\"</span>: <span class=\"string\">\"^0.13.0\"</span>,</div><div class=\"line\">    <span class=\"string\">\"url-loader\"</span>: <span class=\"string\">\"^0.5.8\"</span>,</div><div class=\"line\">    <span class=\"string\">\"webpack\"</span>: <span class=\"string\">\"^1.12.13\"</span>,</div><div class=\"line\">    <span class=\"string\">\"webpack-dev-server\"</span>: <span class=\"string\">\"^1.14.1\"</span>,</div><div class=\"line\">    <span class=\"string\">\"paginationjs\"</span>:<span class=\"string\">\"2.0.8\"</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"主要目录结构\"><a href=\"#主要目录结构\" class=\"headerlink\" title=\"主要目录结构\"></a>主要目录结构</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\">- website</div><div class=\"line\">  - src                #代码开发目录</div><div class=\"line\">    - css              #css目录，按照页面（模块）、通用、第三方三个级别进行组织</div><div class=\"line\">      + page</div><div class=\"line\">      + common</div><div class=\"line\">      + lib</div><div class=\"line\">    + img              #图片资源</div><div class=\"line\">    - js               #JS脚本，按照page、components进行组织</div><div class=\"line\">      + page</div><div class=\"line\">      + components</div><div class=\"line\">      + until</div><div class=\"line\">    - view             #HTML模板</div><div class=\"line\">    - json       \t   #本地moke的数据</div><div class=\"line\">  - dist               #webpack编译打包输出目录，无需建立目录可由webpack根据配置自动生成</div><div class=\"line\">    + css</div><div class=\"line\">    + js</div><div class=\"line\">    + view</div><div class=\"line\">  + node_modules       #所使用的nodejs模块</div><div class=\"line\">  package.json         #项目配置</div><div class=\"line\">  webpack.config.js    #webpack配置</div><div class=\"line\">  README.md            #项目说明</div></pre></td></tr></table></figure>\n<blockquote>\n<p>假如你是一名纯粹的前端工程师，使用webpack构建website的目录结构大概就这样了，当然你也可以根据自己的喜好自由设计目录结构。</p>\n<p>详细的代码全貌可以提前在这里“窥看”——<a href=\"https://github.com/stt04521/multipage_webpack\" target=\"_blank\" rel=\"external\">https://github.com/stt04521/multipage_webpack</a>。</p>\n</blockquote>\n<p>目录组织好，我们就可以开始撸代码了。</p>\n<h4 id=\"开发页面\"><a href=\"#开发页面\" class=\"headerlink\" title=\"开发页面\"></a>开发页面</h4><p>在src/js/page目录下建立index.js文件，在src/view目录下建立index.html文件。入口js和模板文件名对应。</p>\n<p>index.js内容如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//引入css</span></div><div class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">\"../../css/lib/reset.css\"</span>)</div><div class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">\"../../css/common/global.css\"</span>)</div><div class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">\"../../css/common/grid.css\"</span>)</div><div class=\"line\"><span class=\"built_in\">require</span>(<span class=\"string\">\"../../css/page/index.less\"</span>)</div></pre></td></tr></table></figure>\n<p>index.html 内容如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>首页<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">  <span class=\"comment\">&lt;!--</span></div><div class=\"line\">    描述：body中同样无需单独引入JS文件，webpack会根据入口JS文件自动实现按需加载或者生成script标签，还可以生成对应的hash值</div><div class=\"line\">  --&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>就是这样一个简单的HTML模板，我们甚至没有引入任何CSS和JS，通过webpack打包就可以自动帮我们引入。</p>\n<h4 id=\"webpack配置\"><a href=\"#webpack配置\" class=\"headerlink\" title=\"webpack配置\"></a>webpack配置</h4><p>项目 使用的是 art-template 模版渲染，支持es6 ，less ，自动生成入口文件，postcss自动添加样式兼容代码 ，代码热更新</p>\n<p>这里是关键，在webpack.config.js里，我们将进行一些配置，来完成我们的需求，一开始或许有点难理解，但等你真的掌握了，你便会惊呼它的神奇。配置中我写了详细的注释，要想彻底理解，还需多实践，多查阅文档，必要时看看源码，呜呼，学习之路漫漫兮。</p>\n<p>执行<code>npm run build</code> 执行代码打包之后再执行，执行<code>npm run dev</code>启动devServer，打开<a href=\"http://localhost:9090/dist/view/index.html就可以进行正常的页面预览了。说明我们的资源路径生成也是没有问题的。\" target=\"_blank\" rel=\"external\">http://localhost:9090/dist/view/index.html就可以进行正常的页面预览了。说明我们的资源路径生成也是没有问题的。</a></p>\n<p>好了，纯静态的webpack前端构建过程就是这样了。然而你可能还有疑问。</p>\n","thumbnail":"https://i.pximg.net/c/600x600/img-master/img/2017/06/08/14/41/52/63278410_p0_master1200.jpg","categories":[{"name":"技术","path":"api/categories/技术.json"}],"tags":[{"name":"webpack","path":"api/tags/webpack.json"}]}